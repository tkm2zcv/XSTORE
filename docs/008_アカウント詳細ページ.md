# チケット #008: アカウント詳細ページ

## 概要
個別のTwitterアカウントの詳細情報を表示し、購入問い合わせボタンを配置します。

## 目的
- アカウント詳細情報の表示
- 購入問い合わせボタン（LINE・Twitter誘導）
- 関連アカウントの表示
- SEO最適化（動的メタデータ）
- OGP設定

## タスク

### ページファイル作成
- [ ] `/app/(public)/accounts/[id]/page.tsx` 作成

### アカウント詳細コンポーネント
- [ ] `/components/accounts/AccountDetail.tsx` 作成
  - プロフィール画像
  - @username
  - フォロワー数
  - 投稿数
  - アカウント作成日
  - カテゴリ
  - 詳細説明
  - 価格

### 購入問い合わせセクション
- [ ] 問い合わせボタンコンポーネント作成
  - LINE誘導ボタン
  - Twitter誘導ボタン
  - アカウント情報を含むメッセージテンプレート

### 関連アカウントセクション
- [ ] 関連アカウント表示コンポーネント作成
  - 同じカテゴリの他アカウント
  - 類似価格帯のアカウント

### 動的メタデータ
- [ ] generateMetadata 実装
  - title
  - description
  - OGP画像
  - Twitter Card

### エラーハンドリング
- [ ] 404エラー処理（存在しないアカウント）
- [ ] エラーページ作成

### Shadcn/ui コンポーネント追加
- [ ] Tabs コンポーネント追加（将来的な拡張用）

## 技術的な詳細

### app/(public)/accounts/[id]/page.tsx
```typescript
import { Metadata } from 'next';
import { notFound } from 'next/navigation';
import { createServerClient } from '@/lib/supabase';
import { AccountDetail } from '@/components/accounts/AccountDetail';
import { RelatedAccounts } from '@/components/accounts/RelatedAccounts';

async function getAccount(id: string) {
  const supabase = createServerClient();
  const { data, error } = await supabase
    .from('accounts')
    .select('*')
    .eq('id', id)
    .eq('status', 'available')
    .single();

  if (error || !data) {
    return null;
  }

  return data;
}

async function getRelatedAccounts(category: string, currentId: string) {
  const supabase = createServerClient();
  const { data, error } = await supabase
    .from('accounts')
    .select('*')
    .eq('category', category)
    .eq('status', 'available')
    .neq('id', currentId)
    .limit(3);

  if (error) {
    return [];
  }

  return data || [];
}

export async function generateMetadata({
  params,
}: {
  params: { id: string };
}): Promise<Metadata> {
  const account = await getAccount(params.id);

  if (!account) {
    return {
      title: 'アカウントが見つかりません',
    };
  }

  return {
    title: `${account.username} - フォロワー${account.followers_count.toLocaleString()}人 | Twitter Account Market`,
    description: `${account.category}カテゴリのTwitterアカウント。フォロワー${account.followers_count.toLocaleString()}人、投稿数${account.tweets_count.toLocaleString()}件。価格：¥${account.price.toLocaleString()}`,
    openGraph: {
      title: `${account.username} - Twitter Account Market`,
      description: `フォロワー${account.followers_count.toLocaleString()}人のTwitterアカウント`,
      images: [
        {
          url: account.image_url || '/og-image.png',
          width: 1200,
          height: 630,
          alt: account.username,
        },
      ],
      type: 'website',
    },
    twitter: {
      card: 'summary_large_image',
      title: `${account.username} - Twitter Account Market`,
      description: `フォロワー${account.followers_count.toLocaleString()}人`,
      images: [account.image_url || '/og-image.png'],
    },
  };
}

export default async function AccountDetailPage({
  params,
}: {
  params: { id: string };
}) {
  const account = await getAccount(params.id);

  if (!account) {
    notFound();
  }

  const relatedAccounts = await getRelatedAccounts(
    account.category,
    account.id
  );

  return (
    <div className="container py-8">
      <AccountDetail account={account} />
      {relatedAccounts.length > 0 && (
        <RelatedAccounts accounts={relatedAccounts} />
      )}
    </div>
  );
}
```

### components/accounts/AccountDetail.tsx
```typescript
import Image from 'next/image';
import { Account } from '@/types';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Users, MessageSquare, Calendar, ExternalLink } from 'lucide-react';
import { Separator } from '@/components/ui/separator';

interface AccountDetailProps {
  account: Account;
}

export function AccountDetail({ account }: AccountDetailProps) {
  const lineUrl = process.env.NEXT_PUBLIC_LINE_URL;
  const twitterUrl = process.env.NEXT_PUBLIC_TWITTER_URL;

  // 問い合わせメッセージテンプレート
  const inquiryMessage = encodeURIComponent(
    `【アカウント購入問い合わせ】\nアカウント: ${account.username}\n価格: ¥${account.price.toLocaleString()}`
  );

  return (
    <div className="grid gap-8 lg:grid-cols-[2fr_1fr]">
      {/* メイン情報 */}
      <div className="space-y-6">
        <Card>
          <CardContent className="p-6">
            <div className="mb-6 flex items-start gap-6">
              <div className="relative h-24 w-24 flex-shrink-0 overflow-hidden rounded-full">
                <Image
                  src={account.image_url || '/placeholder-avatar.png'}
                  alt={account.username}
                  fill
                  className="object-cover"
                />
              </div>
              <div className="flex-1">
                <div className="mb-2 flex items-center gap-2">
                  <h1 className="text-3xl font-bold">{account.username}</h1>
                  <Badge>{account.category}</Badge>
                </div>
                <div className="flex flex-wrap gap-4 text-muted-foreground">
                  <div className="flex items-center gap-1">
                    <Users className="h-4 w-4" />
                    <span>
                      {account.followers_count.toLocaleString()} フォロワー
                    </span>
                  </div>
                  <div className="flex items-center gap-1">
                    <MessageSquare className="h-4 w-4" />
                    <span>{account.tweets_count.toLocaleString()} 投稿</span>
                  </div>
                  {account.account_created_at && (
                    <div className="flex items-center gap-1">
                      <Calendar className="h-4 w-4" />
                      <span>作成: {account.account_created_at}</span>
                    </div>
                  )}
                </div>
              </div>
            </div>

            <Separator className="my-6" />

            <div>
              <h2 className="mb-4 text-lg font-semibold">アカウント説明</h2>
              <p className="whitespace-pre-wrap text-muted-foreground">
                {account.description || 'このアカウントの説明はありません。'}
              </p>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* サイドバー（購入情報） */}
      <div className="space-y-6">
        <Card>
          <CardContent className="p-6">
            <div className="mb-6">
              <div className="mb-2 text-sm text-muted-foreground">価格</div>
              <div className="text-4xl font-bold text-primary">
                ¥{account.price.toLocaleString()}
              </div>
            </div>

            <Separator className="my-6" />

            <div className="space-y-3">
              <h3 className="font-semibold">購入のお問い合わせ</h3>
              <p className="text-sm text-muted-foreground">
                以下の方法でお問い合わせください
              </p>

              {lineUrl && (
                <Button className="w-full" size="lg" asChild>
                  <a
                    href={`${lineUrl}?text=${inquiryMessage}`}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    LINEで問い合わせ
                    <ExternalLink className="ml-2 h-4 w-4" />
                  </a>
                </Button>
              )}

              {twitterUrl && (
                <Button
                  className="w-full"
                  variant="outline"
                  size="lg"
                  asChild
                >
                  <a
                    href={`${twitterUrl}?text=${inquiryMessage}`}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    Twitterで問い合わせ
                    <ExternalLink className="ml-2 h-4 w-4" />
                  </a>
                </Button>
              )}
            </div>

            <Separator className="my-6" />

            <div className="space-y-2 text-sm text-muted-foreground">
              <div className="flex justify-between">
                <span>ステータス</span>
                <span className="font-medium text-foreground">販売中</span>
              </div>
              <div className="flex justify-between">
                <span>掲載日</span>
                <span className="font-medium text-foreground">
                  {new Date(account.created_at).toLocaleDateString('ja-JP')}
                </span>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* 注意事項 */}
        <Card>
          <CardContent className="p-6">
            <h3 className="mb-4 font-semibold">ご購入前の注意事項</h3>
            <ul className="space-y-2 text-sm text-muted-foreground">
              <li>• アカウント情報の確認をお願いします</li>
              <li>• 取引は慎重に行ってください</li>
              <li>• ご不明な点はお問い合わせください</li>
            </ul>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

### components/accounts/RelatedAccounts.tsx
```typescript
import { Account } from '@/types';
import { AccountCard } from './AccountCard';

interface RelatedAccountsProps {
  accounts: Account[];
}

export function RelatedAccounts({ accounts }: RelatedAccountsProps) {
  return (
    <div className="mt-12">
      <h2 className="mb-6 text-2xl font-bold">関連アカウント</h2>
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {accounts.map((account) => (
          <AccountCard key={account.id} account={account} />
        ))}
      </div>
    </div>
  );
}
```

### app/(public)/accounts/[id]/not-found.tsx
```typescript
import Link from 'next/link';
import { Button } from '@/components/ui/button';

export default function NotFound() {
  return (
    <div className="container flex min-h-[60vh] flex-col items-center justify-center">
      <h1 className="mb-4 text-4xl font-bold">アカウントが見つかりません</h1>
      <p className="mb-8 text-muted-foreground">
        お探しのアカウントは存在しないか、既に売却済みです。
      </p>
      <Button asChild>
        <Link href="/accounts">販売中アカウント一覧へ</Link>
      </Button>
    </div>
  );
}
```

### Shadcn/ui コンポーネント追加
```bash
npx shadcn-ui@latest add tabs
```

## 完了条件
- [ ] アカウント詳細が表示されている
- [ ] 購入問い合わせボタンが動作している
- [ ] 関連アカウントが表示されている
- [ ] 動的メタデータが設定されている
- [ ] 404エラーが適切に処理されている
- [ ] レスポンシブ対応が完了している

## 関連チケット
- 前: #007 販売中アカウント一覧ページ
- 次: #009 買取申込ページ

## 参考
- [Next.js generateMetadata](https://nextjs.org/docs/app/api-reference/functions/generate-metadata)
- [Next.js not-found](https://nextjs.org/docs/app/api-reference/file-conventions/not-found)
